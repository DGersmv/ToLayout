# Система лицензирования плагина

## Описание

Простая система лицензирования для плагина Archicad. Проверка лицензии происходит при загрузке плагина. Если лицензия невалидна, плагин блокируется.

## Формат файла лицензии

Файл лицензии должен находиться **рядом с файлом плагина** (.apx) и иметь расширение `.lic`.

Формат файла (текстовый, одна строка = один параметр):

```
COMPUTER_ID=XX-XX-XX-XX-XX-XX
PLUGIN_NAME=LandscapeHelper_AC27
PLUGIN_VERSION=1.0.0
VALID_UNTIL=2025-12-31
ISSUED_DATE=2024-01-15
LICENSE_KEY=XXXX-XXXX-XXXX-XXXX
```

### Параметры:

- **COMPUTER_ID** - MAC адрес сетевой карты компьютера (формат: XX-XX-XX-XX-XX-XX)
- **PLUGIN_NAME** - Название плагина (должно быть `LandscapeHelper_AC27` или `Browser_Repl_Int`)
- **PLUGIN_VERSION** - Версия плагина (опционально, для информации)
- **VALID_UNTIL** - Дата окончания действия лицензии (формат: YYYY-MM-DD)
- **ISSUED_DATE** - Дата выдачи лицензии (формат: YYYY-MM-DD, опционально)
- **LICENSE_KEY** - Ключ лицензии (опционально, для информации)

### Пример файла:

См. `license.example.lic`

## Как получить идентификатор компьютера

Идентификатор компьютера - это MAC адрес первой сетевой карты. 

Для получения MAC адреса на Windows:
1. Откройте командную строку (cmd)
2. Выполните: `ipconfig /all`
3. Найдите "Физический адрес" (Physical Address) первой сетевой карты
4. Скопируйте адрес в формате XX-XX-XX-XX-XX-XX

## Проверка лицензии

Проверка происходит автоматически при загрузке плагина в Archicad.

### Что проверяется:

1. **Наличие файла лицензии** - файл `license.lic` должен находиться рядом с `.apx` файлом
2. **Идентификатор компьютера** - должен совпадать с MAC адресом текущего компьютера
3. **Название плагина** - должно совпадать с именем плагина
4. **Срок действия** - текущая дата должна быть меньше или равна `VALID_UNTIL`

### Результаты проверки:

- ✅ **VALID** - лицензия валидна, плагин загружается
- ❌ **NOT_FOUND** - файл лицензии не найден
- ❌ **EXPIRED** - лицензия истекла
- ❌ **COMPUTER_MISMATCH** - лицензия не для этого компьютера
- ❌ **PLUGIN_MISMATCH** - лицензия не для этого плагина
- ❌ **PARSE_ERROR** - ошибка формата файла лицензии

## Лог проверки

При каждой проверке лицензии создается/обновляется файл `license.log` рядом с файлом плагина.

Формат записи в логе:
```
[YYYY-MM-DD] Status: STATUS | Computer: XX-XX-XX-XX-XX-XX | Plugin: PluginName | Valid until: YYYY-MM-DD
```

## Генерация лицензий

Генерация лицензий будет реализована на сайте. Для генерации потребуется:
- MAC адрес компьютера пользователя
- Название плагина
- Срок действия лицензии

## Расположение файлов

```
ToArchicad/
  Release/
    LandscapeHelper_AC27.apx    <- файл плагина
    LandscapeHelper_AC27.lic     <- файл лицензии (должен быть здесь)
    LandscapeHelper_AC27.log     <- лог проверки (создается автоматически)
```

## Технические детали

- Класс `LicenseManager` в файлах `LicenseManager.hpp` и `LicenseManager.cpp`
- Проверка лицензии вызывается в функции `Initialize()` в `Main.cpp`
- При невалидной лицензии плагин возвращает ошибку `APIERR_GENERAL` и показывает сообщение пользователю



