<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Landscape Helper</title>

  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:20px; }
    
    /* LANDSCAPE HELPER Logo */
    .logo-container { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      margin: 0 auto 25px; 
      padding: 20px 25px; 
      background: linear-gradient(135deg, #f5f3ee 0%, #ebe8e0 100%);
      border: 1px solid #d4d0c7;
      border-radius: 12px; 
      box-shadow: 0 6px 20px rgba(0,0,0,0.08), 0 2px 6px rgba(0,0,0,0.04);
      max-width: 650px;
      position: relative;
      overflow: hidden;
    }
    .logo-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(79, 96, 79, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(110, 128, 110, 0.03) 0%, transparent 50%);
      pointer-events: none;
    }
    .logo-icon { 
      width: 70px; 
      height: 70px; 
      background: #4F604F;
      border: 2px solid #4F604F;
      border-radius: 12px;
      position: relative;
      margin-right: 20px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    .logo-icon::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #6E806E 0%, #6E806E 45%, #4F604F 45%, #4F604F 100%);
      border-radius: 10px;
    }
    .logo-icon::after {
      content: '';
      position: absolute;
      top: 12px;
      left: 12px;
      width: 16px;
      height: 16px;
      background: #6E806E;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .logo-icon .mountain {
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid #6E806E;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .logo-text { 
      color: #4F604F; 
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
      font-weight: 700;
      text-align: left;
      position: relative;
      z-index: 1;
    }
    .logo-title { 
      font-size: 28px; 
      line-height: 1.0; 
      margin: 0; 
      letter-spacing: 1.2px;
      font-family: 'Segoe UI', Arial, sans-serif;
      text-transform: uppercase;
    }
    .logo-subtitle { 
      font-size: 13px; 
      margin: 4px 0 0 0; 
      letter-spacing: 0.8px;
      opacity: 0.85;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    table.selection-table { border-collapse:collapse; margin:0 auto 20px; width:80%; max-width:800px; background:#fff; }
    table.selection-table th, table.selection-table td { border:1px solid #888; padding:6px 10px; text-align:center; }
    table.selection-table thead { background:#f0f0f0; font-weight:bold; }
    .tabs { text-align:center; margin-bottom:10px; }
    .tablink { display:inline-block; padding:8px 16px; margin:0 4px; border:0; border-radius:4px 4px 0 0; background:#ddd; cursor:pointer; font-size:14px; }
    .tablink.active { background:#366536; color:#fff; }
    .tabcontent { display:none; position:relative; }
    fieldset.control-block { display:block; margin:15px auto; padding:15px; width:400px; max-width:95%; border:1px solid #aaa; border-radius:6px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,.1); }
    fieldset.control-block legend { font-weight:bold; }
    fieldset.control-block label { display:inline-block; width:140px; text-align:right; margin-right:8px; }
    fieldset.control-block input[type="number"] { width:120px; padding:3px; margin:3px 0; }
    fieldset.control-block input[type="button"] { margin:4px 0; padding:4px 10px; cursor:pointer; }
    .info-box { margin-top:10px; padding:6px; background:#f9f9f9; border:1px dashed #aaa; font-size:12px; min-height:30px; white-space:pre-wrap; }
    a { display:block; text-align:center; margin-top:20px; }
    .tab-help { position:absolute; right:10px; bottom:10px; padding:8px 12px; border:0; border-radius:8px; background:#366536; color:#fff; font-weight:600; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.2); }
    .tab-help:hover { filter:brightness(1.05); }
    .tab-help:active { transform:translateY(1px); }

    /* Black log strip */
    #log-box { 
      margin-top:10px; 
      padding:8px; 
      background:#111; 
      color:#0f0; 
      font-family:monospace; 
      font-size:12px; 
      height:140px; 
      overflow:auto; 
      display:none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –≤ Debug –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ C++ –∫–æ–¥ */
    }
    .muted { opacity:.6; }
  </style>

  <script type="text/javascript">
    "use strict";

    // ================= helpers =================
    let logBuffer = ''; // –ë—É—Ñ–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤ (—Å–∫–æ—Ä–æ—Å—Ç—å!)
    
    function AddLog(msg) {
      // Log to console
      try { console.log(String(msg)); } catch(_) {}
      
      // Also log to UI
      const box = document.getElementById('log-box');
      if (!box) return;
      
      const now = new Date().toLocaleTimeString();
      logBuffer += "\n[" + now + "] " + msg;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –±—É—Ñ–µ—Ä (–º–∞–∫—Å 5000 —Å–∏–º–≤–æ–ª–æ–≤)
      if (logBuffer.length > 5000) {
        logBuffer = logBuffer.substring(logBuffer.length - 4000);
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–¥–Ω–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
      box.textContent = logBuffer;
      box.scrollTop = box.scrollHeight;
    }
    
    function setInfo(id, msg) {
      const el = document.getElementById(id);
      if (el) el.textContent = msg;
    }
    function parseNumber(inputEl, def = 0) {
      let v = (typeof inputEl.valueAsNumber === 'number' && !isNaN(inputEl.valueAsNumber)) ? inputEl.valueAsNumber : NaN;
      if (isNaN(v)) {
        const p = parseFloat(String(inputEl.value || "").replace(',', '.'));
        v = Number.isFinite(p) ? p : def;
      }
      return v;
    }

    // Global variable for storing the last applied markup step
    let g_lastMarkupStepMm = 2500; // Default value

    // =============== ACAPI bridge waiting (with diagnostics) ===============
    function whenACAPIReadyDo(cb) {
      let fired = false;
      const probe = () => {
        const A = window.ACAPI;
        if (!A) return null;
        return {
          hasSelect : typeof A.GetSelectedElements === 'function',
          hasGround : typeof A.ApplyGroundOffset  === 'function',
          hasNewDlt : typeof A.SetZDelta         === 'function' && typeof A.ApplyZDelta === 'function',
          hasOldDlt : typeof A.ApplyZDelta       === 'function' && A.ApplyZDelta.length >= 1
        };
      };
      const ready = () => {
        const caps = probe();
        return caps && (caps.hasSelect || caps.hasGround || caps.hasNewDlt || caps.hasOldDlt);
      };
      const fire = () => {
        if (fired) return;
        fired = true;
        try {
          const caps = probe();
          AddLog(`[UI] ACAPI ready: select=${!!caps.hasSelect} ground=${!!caps.hasGround} newŒî=${!!caps.hasNewDlt} oldŒî=${!!caps.hasOldDlt}`);
          cb();
        } catch (e) { AddLog('[UI] callback error: ' + e); }
      };

      if (ready()) { fire(); return; }

      let tries = 0;
      const maxTries = 120;
      const iv = setInterval(() => {
        if (ready()) {
          clearInterval(iv);
          fire();
        } else if (++tries > maxTries) {
          clearInterval(iv);
          AddLog('[UI] ACAPI never appeared (check palette/plugin loading)');
        }
      }, 50);
    }

    // =============== selection table ===============
    function UpdateSelectedElements() {
      const A = window.ACAPI;
      if (!A || typeof A.GetSelectedElements !== 'function') {
        // AddLog('[UI] ACAPI.GetSelectedElements unavailable');
        return;
      }
      A.GetSelectedElements().then(function (elemInfos) {
        const selectionTable = document.getElementById('selection');
        
        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ appendChild
        let html = '';

        if (!elemInfos || elemInfos.length === 0) {
          html = '<tr><td colspan="4">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</td></tr>';
        } else {
          const grouped = {};
          for (let i = 0; i < elemInfos.length; i++) {
            const typeName  = elemInfos[i][1];
            const elemID    = elemInfos[i][2];
            const layerName = elemInfos[i][3] || 'Unknown';
            
            const key = typeName + "||" + elemID + "||" + layerName;
            if (!grouped[key]) grouped[key] = { type: typeName, id: elemID, layer: layerName, count: 0 };
            grouped[key].count++;
          }
          
          // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —Ñ–æ—Ä–º–∏—Ä—É–µ–º –≤–µ—Å—å HTML –∑–∞ —Ä–∞–∑
          for (const key of Object.keys(grouped)) {
            html += '<tr>' +
              '<td>' + grouped[key].type  + '</td>' +
              '<td>' + grouped[key].id    + '</td>' +
              '<td>' + grouped[key].layer + '</td>' +
              '<td>' + grouped[key].count + '</td>' +
              '</tr>';
          }
        }
        
        // –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è DOM –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞
        selectionTable.innerHTML = html;
      }).catch(err => console.log('[UI] GetSelectedElements error: ' + err));
    }

    // =============== ID renaming (bulk, without layers) ===============
    function changeAllSelectedIDs() {
      const A = window.ACAPI;
      if (!A || typeof A.ChangeSelectedElementsID !== 'function') {
        AddLog('[UI] ACAPI.ChangeSelectedElementsID unavailable');
        return;
      }
      
      const baseID = document.getElementById('baseID').value.trim();
      if (!baseID) {
        AddLog('[UI] Enter base name for element IDs');
        document.getElementById('baseID').focus();
        return;
      }
      
      AddLog('[UI] Changing element IDs with base name: ' + baseID);
      
      A.ChangeSelectedElementsID(baseID).then(function(success) {
        if (success) {
          AddLog('[UI] ‚úÖ All selected element IDs successfully changed!');
          setInfo("id-change-info", "‚úÖ ID –∏–∑–º–µ–Ω–µ–Ω—ã! –ü—Ä–∏–º–µ—Ä—ã: " + baseID + "-01, " + baseID + "-02, " + baseID + "-03...");
          document.getElementById('baseID').value = '';
          setTimeout(UpdateSelectedElements, 1000);
        } else {
          AddLog('[UI] ‚ùå Error changing element IDs');
          setInfo("id-change-info", "‚ùå –û—à–∏–±–∫–∞! –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ ID");
        }
      }).catch(function(err) {
        AddLog('[UI] ‚ùå Error calling ChangeSelectedElementsID: ' + err);
        setInfo("id-change-info", "‚ùå –û—à–∏–±–∫–∞: " + err);
      });
    }

    // –•—Ä–∞–Ω–∏–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    let allLayersData = [];
    
    // –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å "–°–ª–æ–∏/" –∏–ª–∏ "Layers/" –∏–∑ –ø—É—Ç–∏
    function removeRootFolderPrefix(path) {
      if (!path || path === '') return '';
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –ø—É—Ç—å —Å "–°–ª–æ–∏/" –∏–ª–∏ "Layers/"
      if (path.startsWith('–°–ª–æ–∏/')) {
        return path.substring('–°–ª–æ–∏/'.length);
      }
      if (path.startsWith('Layers/')) {
        return path.substring('Layers/'.length);
      }
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑ —Å–ª—ç—à–∞ –≤ –∫–æ–Ω—Ü–µ
      if (path === '–°–ª–æ–∏' || path === 'Layers') {
        return '';
      }
      return path;
    }
    
    // =============== folder/layer list loading ===============
    function loadExistingLayersList(filterText = '') {
      const A = window.ACAPI;
      const listEl = document.getElementById('existingLayersList');
      if (!listEl) return;

      listEl.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>';

      if (!A) {
        listEl.innerHTML = '<option value="">ACAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</option>';
        return;
      }

      // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–æ–µ–≤ –µ—Å—Ç—å, –≤—ã–∑—ã–≤–∞–µ–º –µ—ë
      if (typeof A.GetLayersList === 'function') {
        A.GetLayersList().then(function(layersData) {
          if (!layersData || layersData.length === 0) {
            listEl.innerHTML = '<option value="">–°–ª–æ–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
            allLayersData = [];
            return;
          }

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
          allLayersData = [];
          
          // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤ –≤ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
          for (let i = 0; i < layersData.length; i++) {
            const item = layersData[i];
            if (Array.isArray(item) && item.length >= 2) {
              allLayersData.push({
                name: item[0] || '',
                folder: item[1] || ''
              });
            }
          }

          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
          filterLayersList(filterText);
        }).catch(function(err) {
          AddLog('[UI] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–µ–≤: ' + err);
          listEl.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–µ–≤</option>';
          allLayersData = [];
        });
      } else {
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É
        listEl.innerHTML = '<option value="">–§—É–Ω–∫—Ü–∏—è GetLayersList –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</option>';
        AddLog('[UI] –§—É–Ω–∫—Ü–∏—è GetLayersList –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
        allLayersData = [];
      }
    }

    function filterLayersList(filterText = '') {
      const listEl = document.getElementById('existingLayersList');
      if (!listEl) return;

      listEl.innerHTML = '';
      
      if (allLayersData.length === 0) {
        listEl.innerHTML = '<option value="">–°–ª–æ–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
        return;
      }

      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–∫—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞
      const filter = filterText.trim().toLowerCase();
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –ø–∞–ø–∫–∞–º
      const folders = {};
      const rootLayers = [];
      const folderSet = new Set(); // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫

      for (let i = 0; i < allLayersData.length; i++) {
        const item = allLayersData[i];
        const folderPath = item.folder || '';
        const layerName = item.name || '';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä—É
        const matchesFilter = !filter || 
          folderPath.toLowerCase().startsWith(filter) || 
          layerName.toLowerCase().startsWith(filter);
        
        if (!matchesFilter) continue;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–ø–∫–∏ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ
        if (folderPath) {
          const pathParts = folderPath.split('/').filter(p => p);
          let currentPath = '';
          for (let j = 0; j < pathParts.length; j++) {
            currentPath = currentPath ? currentPath + '/' + pathParts[j] : pathParts[j];
            if (!filter || currentPath.toLowerCase().startsWith(filter)) {
              folderSet.add(currentPath);
            }
          }
        }
        
        if (!folderPath || folderPath === '') {
          rootLayers.push({ name: layerName, fullPath: layerName, isFolder: false });
        } else {
          const pathParts = folderPath.split('/').filter(p => p);
          let current = folders;
          
          // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
          for (let j = 0; j < pathParts.length; j++) {
            const part = pathParts[j];
            if (!current[part]) {
              current[part] = { _layers: [], _subfolders: {} };
            }
            if (j === pathParts.length - 1) {
              // –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–∞–ø–∫–∞ - –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π
              const fullPath = folderPath + '/' + layerName;
              current[part]._layers.push({ name: layerName, fullPath: fullPath, folderPath: folderPath });
            } else {
              // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –ø–∞–ø–∫–∞ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≥–ª—É–±–∂–µ
              current = current[part]._subfolders;
            }
          }
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—ã–µ —Å–ª–æ–∏
      rootLayers.sort((a, b) => a.name.localeCompare(b.name));
      for (let i = 0; i < rootLayers.length; i++) {
        const opt = document.createElement('option');
        opt.value = rootLayers[i].fullPath;
        opt.textContent = 'üìÑ ' + rootLayers[i].name;
        opt.dataset.type = 'layer';
        opt.dataset.folder = '';
        opt.dataset.layer = rootLayers[i].name;
        listEl.appendChild(opt);
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–ø–∫–∏ –∏ —Å–ª–æ–∏ –≤ –Ω–∏—Ö
      function addFoldersToSelect(foldersObj, prefix = '') {
        const folderNames = Object.keys(foldersObj).sort();
        for (let i = 0; i < folderNames.length; i++) {
          const folderName = folderNames[i];
          if (folderName.startsWith('_')) continue;

          const folder = foldersObj[folderName];
          const currentPath = prefix ? prefix + '/' + folderName : folderName;

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–ª–∂–Ω–∞ –ª–∏ –ø–∞–ø–∫–∞ –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä)
          if (filter && !currentPath.toLowerCase().startsWith(filter) && 
              (!folder._layers || folder._layers.length === 0)) {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä—É –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–∏
            if (folder._subfolders && Object.keys(folder._subfolders).length > 0) {
              // –ù–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–ø–∞–ø–∫–∏
              addFoldersToSelect(folder._subfolders, currentPath);
            }
            continue;
          }

          // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–ø–∫—É
          const folderOpt = document.createElement('option');
          folderOpt.value = currentPath;
          folderOpt.textContent = 'üìÅ ' + currentPath;
          folderOpt.style.fontWeight = 'bold';
          folderOpt.dataset.type = 'folder';
          folderOpt.dataset.folder = currentPath;
          listEl.appendChild(folderOpt);

          // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –≤ –ø–∞–ø–∫–µ
          if (folder._layers && folder._layers.length > 0) {
            folder._layers.sort((a, b) => a.name.localeCompare(b.name));
            for (let j = 0; j < folder._layers.length; j++) {
              const layer = folder._layers[j];
              const layerOpt = document.createElement('option');
              layerOpt.value = layer.fullPath;
              layerOpt.textContent = '  ‚îî‚îÄ üìÑ ' + layer.name;
              layerOpt.dataset.type = 'layer';
              layerOpt.dataset.folder = layer.folderPath;
              layerOpt.dataset.layer = layer.name;
              listEl.appendChild(layerOpt);
            }
          }

          // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∞–ø–∫–∏
          if (folder._subfolders && Object.keys(folder._subfolders).length > 0) {
            addFoldersToSelect(folder._subfolders, currentPath);
          }
        }
      }

      addFoldersToSelect(folders);

      if (listEl.options.length === 0) {
        listEl.innerHTML = '<option value="">–ù–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–ª–æ–µ–≤</option>';
      }
    }

    function selectFromList() {
      const listEl = document.getElementById('existingLayersList');
      if (!listEl || listEl.selectedIndex < 0) return;

      const selectedOption = listEl.options[listEl.selectedIndex];
      if (!selectedOption || !selectedOption.value) return;

      const optionType = selectedOption.dataset.type || '';
      
      if (optionType === 'folder') {
        // –≠—Ç–æ –ø–∞–ø–∫–∞
        const folderPath = selectedOption.dataset.folder || selectedOption.value;
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "–°–ª–æ–∏/" –∏–ª–∏ "Layers/" –∏–∑ –ø—É—Ç–∏
        const cleanFolderPath = removeRootFolderPrefix(folderPath);
        document.getElementById('layerFolder').value = cleanFolderPath;
        document.getElementById('layerName').value = '';
        AddLog('[UI] –í—ã–±—Ä–∞–Ω–∞ –ø–∞–ø–∫–∞: ' + cleanFolderPath);
      } else if (optionType === 'layer') {
        // –≠—Ç–æ —Å–ª–æ–π
        const folderPath = selectedOption.dataset.folder || '';
        const layerName = selectedOption.dataset.layer || '';
        
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "–°–ª–æ–∏/" –∏–ª–∏ "Layers/" –∏–∑ –ø—É—Ç–∏
        const cleanFolderPath = removeRootFolderPrefix(folderPath);
        document.getElementById('layerFolder').value = cleanFolderPath;
        document.getElementById('layerName').value = layerName;
        AddLog('[UI] –í—ã–±—Ä–∞–Ω —Å–ª–æ–π: ' + (cleanFolderPath ? cleanFolderPath + ' / ' : '') + layerName);
      }
    }

    // =============== folder/layer creation + move ===============
    function createLayerAndMoveElements() {
      const A = window.ACAPI;
      if (!A) {
        AddLog('[UI] ACAPI unavailable');
        return;
      }

      let folderPath = document.getElementById('layerFolder').value.trim();
      const layerName  = document.getElementById('layerName').value.trim();
      const hideLayer = document.getElementById('hideLayer').checked;

      // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "–°–ª–æ–∏/" –∏–ª–∏ "Layers/" –∏–∑ –ø—É—Ç–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
      folderPath = removeRootFolderPrefix(folderPath);

      if (!folderPath && !layerName) {
        AddLog('[UI] –í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –∏–ª–∏ –∏–º—è —Å–ª–æ—è');
        document.getElementById('layerFolder').focus();
        return;
      }
      if (!layerName) {
        AddLog('[UI] –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–ª–æ—è');
        document.getElementById('layerName').focus();
        return;
      }

      AddLog('[UI] –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏: ' + folderPath + ', —Å–ª–æ–π: ' + layerName + ', —Å–∫—Ä—ã—Ç—å: ' + hideLayer);
      setInfo("info-layers", "–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏, —Å–ª–æ—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤...");

      if (typeof A.CreateLayerAndMoveElements === 'function') {
        const params = folderPath + '|' + layerName + '|' + (hideLayer ? '1' : '0');

        AddLog('[JS] CreateLayerAndMoveElements');
        AddLog('[JS] Parameters: ' + params);
        
        A.CreateLayerAndMoveElements(params).then(function(success) {
          AddLog('[JS] CreateLayerAndMoveElements returned: ' + success);
          if (success) {
            AddLog('[UI] ‚úÖ –ü–∞–ø–∫–∞/—Å–ª–æ–π —Å–æ–∑–¥–∞–Ω—ã, —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã!');
            setInfo("info-layers", "‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü–∞–ø–∫–∞: " + folderPath + ", –°–ª–æ–π: " + layerName);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            document.getElementById('layerFolder').value  = '';
            document.getElementById('layerName').value    = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–ª–æ–µ–≤ –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (—á—Ç–æ–±—ã ArchiCAD —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
            setTimeout(function() {
              loadExistingLayersList(''); // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–ª–æ–∏ –∏ –ø–∞–ø–∫–∏
            }, 500);
            
            setTimeout(UpdateSelectedElements, 1000);
          } else {
            AddLog('[UI] ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–∫–∏/—Å–ª–æ—è –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤');
            setInfo("info-layers", "‚ùå –û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/–≤—ã–±–æ—Ä.");
          }
        }).catch(function(err) {
          AddLog('[UI] ‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ CreateLayerAndMoveElements: ' + err);
          setInfo("info-layers", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[UI] ‚ùå –§—É–Ω–∫—Ü–∏—è CreateLayerAndMoveElements –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
        setInfo("info-layers", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    // =============== orientation/distribution/... ===============
    function RotateSelection() {
      const s = document.getElementById('rotateAngle').value;
      if (window.ACAPI && typeof ACAPI.RotateSelected === 'function') ACAPI.RotateSelected(s);
      setInfo("info-orient", "–ü–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ " + s + "¬∞");
    }
    function AlignSelectionX()         { if (ACAPI?.AlignSelectedX)         ACAPI.AlignSelectedX();         setInfo("info-orient", "–í—ã—Ä–æ–≤–Ω–µ–Ω–æ –ø–æ X"); }
    function RandomizeAngles()         { if (ACAPI?.RandomizeSelectedAngles) ACAPI.RandomizeSelectedAngles(); setInfo("info-orient", "–ü—Ä–∏–º–µ–Ω–µ–Ω —Å–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª"); }
    function OrientObjectsToPoint()    { if (ACAPI?.OrientObjectsToPoint)    ACAPI.OrientObjectsToPoint();    setInfo("info-orient", "–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –∫ —Ç–æ—á–∫–µ"); }
    function SetDistributionLine()     { if (ACAPI?.SetDistributionLine)     ACAPI.SetDistributionLine();     setInfo("info-dist","–õ–∏–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"); }
    function SetDistributionObject()   { if (ACAPI?.SetDistributionObject)   ACAPI.SetDistributionObject();   setInfo("info-dist","–û–±—ä–µ–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"); }
    
    // Column orientation functions
    function SetColumnsForOrient() {
      AddLog('[Columns] SetColumnsForOrient called');
      if (ACAPI?.SetColumns) {
        AddLog('[Columns] Calling ACAPI.SetColumns...');
        ACAPI.SetColumns().then(function(success) {
          AddLog('[Columns] SetColumns returned: ' + success);
          if (success) {
            setInfo("info-columns", "‚úÖ –ö–æ–ª–æ–Ω–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
          } else {
            // –ü–æ–ø—Ä–æ–±—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∫–∏, –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            AddLog('[Columns] No columns found, trying beams...');
            if (ACAPI?.SetBeams) {
              ACAPI.SetBeams().then(function(beamSuccess) {
                AddLog('[Columns] SetBeams returned: ' + beamSuccess);
                setInfo("info-columns", beamSuccess ? "‚úÖ –ë–∞–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)" : "‚ùå –ö–æ–ª–æ–Ω–Ω—ã –∏–ª–∏ –±–∞–ª–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–æ–Ω–Ω—ã –∏–ª–∏ –±–∞–ª–∫–∏.");
              });
            } else {
              setInfo("info-columns", "‚ùå –ö–æ–ª–æ–Ω–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–æ–Ω–Ω—ã.");
            }
          }
        }).catch(function(err) {
          AddLog('[Columns] SetColumns error: ' + err);
          setInfo("info-columns", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[Columns] ACAPI.SetColumns unavailable');
        setInfo("info-columns", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function SetMeshForColumns() {
      AddLog('[Columns] SetMeshForColumns called');
      if (ACAPI?.SetMeshForColumns) {
        AddLog('[Columns] Calling ACAPI.SetMeshForColumns...');
        ACAPI.SetMeshForColumns().then(function(success) {
          AddLog('[Columns] SetMeshForColumns returned: ' + success);
          setInfo("info-columns", success ? "‚úÖ –°–µ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞" : "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É");
        }).catch(function(err) {
          AddLog('[Columns] SetMeshForColumns error: ' + err);
          setInfo("info-columns", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[Columns] ACAPI.SetMeshForColumns unavailable');
        setInfo("info-columns", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function OrientColumnsToSurface() {
      AddLog('[Columns] OrientColumnsToSurface called');
      if (ACAPI?.OrientColumnsToSurface) {
        setInfo("info-columns", "–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏...");
        AddLog('[Columns] Calling ACAPI.OrientColumnsToSurface...');
        ACAPI.OrientColumnsToSurface().then(function(success) {
          AddLog('[Columns] OrientColumnsToSurface returned: ' + success);
          if (success) {
            setInfo("info-columns", "‚úÖ –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏");
          } else {
            // –ü–æ–ø—Ä–æ–±—É–µ–º –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∫–∏
            AddLog('[Columns] Columns orientation failed, trying beams...');
            if (ACAPI?.OrientBeamsToSurface) {
              ACAPI.OrientBeamsToSurface().then(function(beamSuccess) {
                AddLog('[Columns] OrientBeamsToSurface returned: ' + beamSuccess);
                setInfo("info-columns", beamSuccess ? "‚úÖ –ë–∞–ª–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏" : "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–Ω–∞—á–∞–ª–∞.");
              });
            } else {
              setInfo("info-columns", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–ª–æ–Ω–Ω—ã/–±–∞–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–Ω–∞—á–∞–ª–∞.");
            }
          }
        }).catch(function(err) {
          AddLog('[Columns] OrientColumnsToSurface error: ' + err);
          setInfo("info-columns", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[Columns] ACAPI.OrientColumnsToSurface unavailable');
        setInfo("info-columns", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function SetBeamsForOrient() {
      AddLog('[Beams] SetBeamsForOrient called');
      if (ACAPI?.SetBeams) {
        AddLog('[Beams] Calling ACAPI.SetBeams...');
        ACAPI.SetBeams().then(function(success) {
          AddLog('[Beams] SetBeams returned: ' + success);
          if (success) {
            setInfo("info-beams", "‚úÖ –ë–∞–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
          } else {
            // –ü–æ–ø—Ä–æ–±—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–æ–Ω–Ω—ã, –µ—Å–ª–∏ –±–∞–ª–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            AddLog('[Beams] No beams found, trying columns...');
            if (ACAPI?.SetColumns) {
              ACAPI.SetColumns().then(function(colSuccess) {
                AddLog('[Beams] SetColumns returned: ' + colSuccess);
                setInfo("info-beams", colSuccess ? "‚úÖ –ö–æ–ª–æ–Ω–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)" : "‚ùå –ë–∞–ª–∫–∏ –∏–ª–∏ –∫–æ–ª–æ–Ω–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏ –∏–ª–∏ –∫–æ–ª–æ–Ω–Ω—ã.");
              });
            } else {
              setInfo("info-beams", "‚ùå –ë–∞–ª–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏.");
            }
          }
        }).catch(function(err) {
          AddLog('[Beams] SetBeams error: ' + err);
          setInfo("info-beams", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[Beams] ACAPI.SetBeams unavailable');
        setInfo("info-beams", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function OrientBeamsToSurface() {
      AddLog('[Beams] OrientBeamsToSurface called');
      if (ACAPI?.OrientBeamsToSurface) {
        setInfo("info-beams", "–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –±–∞–ª–æ–∫ –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏...");
        AddLog('[Beams] Calling ACAPI.OrientBeamsToSurface...');
        ACAPI.OrientBeamsToSurface().then(function(success) {
          AddLog('[Beams] OrientBeamsToSurface returned: ' + success);
          setInfo("info-beams", success ? "‚úÖ –ë–∞–ª–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏" : "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∫–∏");
        }).catch(function(err) {
          AddLog('[Beams] OrientBeamsToSurface error: ' + err);
          setInfo("info-beams", "‚ùå –û—à–∏–±–∫–∞: " + err);
        });
      } else {
        AddLog('[Beams] ACAPI.OrientBeamsToSurface unavailable');
        setInfo("info-beams", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function RotateSelectedOrientation() {
      AddLog('[Rotate] RotateSelectedOrientation called');
      const angleInput = document.getElementById('rotateAngleInput');
      if (!angleInput) {
        AddLog('[Rotate] rotateAngleInput not found');
        return;
      }
      const angleDeg = Number(angleInput.value) || 0;
      AddLog('[Rotate] Angle from input: ' + angleDeg + ' degrees');
      
      if (ACAPI?.RotateSelectedOrientation) {
        setInfo("info-rotate", "–ü–æ–≤–æ—Ä–æ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤...");
        AddLog('[Rotate] Calling ACAPI.RotateSelectedOrientation(' + angleDeg + ')...');
        const result = ACAPI.RotateSelectedOrientation(angleDeg);
        if (result && typeof result.then === 'function') {
          result.then(function(success) {
            AddLog('[Rotate] RotateSelectedOrientation returned: ' + success);
            setInfo("info-rotate", success ? "‚úÖ –ü–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ " + angleDeg + "¬∞" : "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–≤–µ—Ä–Ω—É—Ç—å. –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏.");
          }).catch(function(err) {
            AddLog('[Rotate] RotateSelectedOrientation error: ' + err);
            setInfo("info-rotate", "‚ùå –û—à–∏–±–∫–∞: " + err);
          });
        } else {
          AddLog('[Rotate] RotateSelectedOrientation returned: ' + result);
          setInfo("info-rotate", result ? "‚úÖ –ü–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ " + angleDeg + "¬∞" : "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–≤–µ—Ä–Ω—É—Ç—å. –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏.");
        }
      } else {
        AddLog('[Rotate] ACAPI.RotateSelectedOrientation unavailable');
        setInfo("info-rotate", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
      }
    }
    function SetDistributionStep () {
      const s = parseNumber(document.getElementById('distStep'), 0);
      const step = (isFinite(s) && s > 0) ? s : 0;
      if (ACAPI?.SetDistributionStep) ACAPI.SetDistributionStep(step);
      if (step > 0 && ACAPI?.DistributeNow) {
        const payload = "step:" + step;
        AddLog("[UI] Step OK ‚Üí " + payload);
        ACAPI.DistributeNow(payload).then(ok => setInfo("info-dist", ok ? "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –ø–æ —à–∞–≥—É" : "–û—à–∏–±–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"));
      } else if (step <= 0) setInfo("info-dist", "–®–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0");
    }
    function SetDistributionCount () {
      const c = parseInt((document.getElementById('distCount').value || "0"), 10);
      const count = (isFinite(c) && c > 0) ? c : 0;
      if (ACAPI?.SetDistributionCount) ACAPI.SetDistributionCount(count);
      if (count > 0 && ACAPI?.DistributeNow) {
        const payload = "count:" + count;
        AddLog("[UI] Count OK ‚Üí " + payload);
        ACAPI.DistributeNow(payload).then(ok => setInfo("info-dist", ok ? "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É" : "–û—à–∏–±–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"));
      } else if (count <= 0) setInfo("info-dist", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â• 1");
    }

    // ================= SHELL / CONTOURS =================
    async function SetMeshForContours() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Setting mesh for contours...');
      setInfo("info-shell", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ç–∫–∏...");

      if (typeof A.SetMeshSurfaceForShell === 'function') {
        try {
          const success = await A.SetMeshSurfaceForShell();
          if (success) {
            AddLog('[UI] ‚úÖ Mesh set successfully');
            setInfo("info-shell", "‚úÖ –°–µ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Failed to set mesh. Make sure a mesh is selected');
            setInfo("info-shell", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–∞");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling SetMeshSurfaceForShell: ' + err);
          setInfo("info-shell", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function SetMeshSurfaceForShell is unavailable');
        setInfo("info-shell", "‚ùå Function unavailable (update the plugin)");
      }
    }

    function SelectBaseLine() {
      const A = window.ACAPI;
      if (!A) { AddLog('[Shell] ACAPI unavailable'); return; }
      if (!A.SetBaseLineForShell) {
        AddLog('[Shell] API function SetBaseLineForShell is unavailable');
        setInfo('info-shell', '–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)');
        return;
      }

      AddLog('[Shell] Selecting base line...');
      setInfo('info-shell', '–í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—É—é –ª–∏–Ω–∏—é (—Å–ø–ª–∞–π–Ω/–ø–æ–ª–∏–ª–∏–Ω–∏—è/–¥—É–≥–∞/–ª–∏–Ω–∏—è)...');

      Promise.resolve(A.SetBaseLineForShell()).then(success => {
        if (success) {
          setInfo('info-shell', '‚úÖ –ë–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è –≤—ã–±—Ä–∞–Ω–∞!');
          AddLog('[Shell] Base line selected');
        } else {
          setInfo('info-shell', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é');
          AddLog('[Shell] Line selection error');
        }
      }).catch(e => {
        AddLog('[Shell] Error: ' + e);
        setInfo('info-shell', '‚ùå –û—à–∏–±–∫–∞: ' + e);
      });
    }

    function CreateShellFromLine() {
      const A = window.ACAPI;
      if (!A) { AddLog('[Shell] ACAPI unavailable'); return; }
      if (!A.CreateShellFromLine) {
        AddLog('[Shell] API function is unavailable');
        setInfo('info-shell', '–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)');
        return;
      }

      const width = parseNumber(document.getElementById('shellWidth'), 1000);
      const step  = parseNumber(document.getElementById('shellStep'), 500);
      
      if (width <= 0) {
        setInfo('info-shell', '–®–∏—Ä–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0');
        return;
      }
      if (step <= 0) {
        setInfo('info-shell', '–®–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0');
        return;
      }

      AddLog('[Shell] Creating shell: width=' + width + ' mm, step=' + step + ' mm');
      setInfo('info-shell', '–°–æ–∑–¥–∞–Ω–∏–µ –æ–±–æ–ª–æ—á–∫–∏...');

      const params = "width:" + width + ",step:" + step;
      AddLog('[Shell] Calling ACAPI.CreateShellFromLine with parameters: ' + params);
      Promise.resolve(A.CreateShellFromLine(params)).then(success => {
        if (success) {
          setInfo('info-shell', '‚úÖ –û–±–æ–ª–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
          AddLog('[Shell] SUCCESS');
        } else {
          setInfo('info-shell', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ–±–æ–ª–æ—á–∫—É');
          AddLog('[Shell] FAILED');
        }
      }).catch(e => {
        AddLog('[Shell] Error: ' + e);
        setInfo('info-shell', '‚ùå –û—à–∏–±–∫–∞: ' + e);
      });
    }

    // ================= MARKUP/DIMENSIONS =================
    async function SetMarkupStepUI() {
      AddLog('[UI] SetMarkupStepUI called');
      const A = window.ACAPI;
      if (!A) {
        AddLog('[UI] ACAPI unavailable');
        return;
      }

      const stepInput = document.getElementById('markupStep');
      const stepStr = stepInput.value;
      const stepMm = parseFloat(stepStr);
      
      // Force conversion to number (diagnostics)
      const stepMmNumber = Number(stepStr);
      
      if (isNaN(stepMm) || stepMm <= 0) {
        AddLog('[UI] Invalid markup step value');
            setInfo("info-markup", "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —à–∞–≥–∞ —Ä–∞–∑–º–µ—Ç–∫–∏");
        return;
      }

      AddLog('[UI] Setting markup step: ' + stepMm + ' mm');
      setInfo("info-markup", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∞–≥–∞ —Ä–∞–∑–º–µ—Ç–∫–∏...");

      if (typeof A.SetMarkupStep === 'function') {
        try {
          const success = await A.SetMarkupStep(stepMmNumber.toString()); // avoid INTEGER coercion
          if (success) {
            g_lastMarkupStepMm = stepMmNumber;
            AddLog('[UI] ‚úÖ Markup step set: ' + stepMmNumber + ' mm');
            setInfo("info-markup", "‚úÖ –®–∞–≥ —Ä–∞–∑–º–µ—Ç–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + stepMmNumber + " –º–º");
          } else {
            AddLog('[UI] ‚ùå Error setting markup step');
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à–∞–≥–∞ —Ä–∞–∑–º–µ—Ç–∫–∏");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling SetMarkupStep: ' + err);
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function SetMarkupStep is unavailable');
        setInfo("info-markup", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function CreateMarkupUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      // Use the saved step (if user pressed "Set"), otherwise read from field
      let stepMm = g_lastMarkupStepMm;
      if (g_lastMarkupStepMm === 2500) {
        const stepInput = document.getElementById('markupStep');
        const fieldStepMm = parseFloat(stepInput.value);
        if (!isNaN(fieldStepMm) && fieldStepMm > 0) {
          stepMm = fieldStepMm;
          AddLog('[UI] Using step from field: ' + stepMm + ' mm');
        }
      } else {
        AddLog('[UI] Using previously set step: ' + stepMm + ' mm');
      }
      
      // Ensure step set in backend
      AddLog('[UI] Applying step: ' + stepMm + ' mm');
      try {
        const stepSuccess = await A.SetMarkupStep(stepMm.toString());
        if (stepSuccess) {
          g_lastMarkupStepMm = stepMm;
          AddLog('[UI] ‚úÖ Step applied: ' + stepMm + ' mm');
        } else {
          AddLog('[UI] ‚ùå Error applying step');
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞");
          return;
        }
      } catch (err) {
        AddLog('[UI] ‚ùå Error applying step: ' + err);
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞");
        return;
      }

      AddLog('[UI] Creating markup');
      setInfo("info-markup", "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏...");

      if (typeof A.CreateMarkupDimensions === 'function') {
        try {
          const success = await A.CreateMarkupDimensions();
          if (success) {
            AddLog('[UI] ‚úÖ Markup created successfully');
            setInfo("info-markup", "‚úÖ –†–∞–∑–º–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Error creating markup');
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ç–∫–∏");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling CreateMarkupDimensions: ' + err);
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function CreateMarkupDimensions is unavailable');
        setInfo("info-markup", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function CreateDimensionsToLineUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Creating dimensions to line');
      setInfo("info-markup", "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫ –ª–∏–Ω–∏–∏...");

      if (typeof A.CreateDimensionsToLine === 'function') {
        try {
          const success = await A.CreateDimensionsToLine();
          if (success) {
            AddLog('[UI] ‚úÖ Dimensions to line created successfully');
            setInfo("info-markup", "‚úÖ –†–∞–∑–º–µ—Ä—ã –∫ –ª–∏–Ω–∏–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Error creating dimensions to line');
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫ –ª–∏–Ω–∏–∏");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling CreateDimensionsToLine: ' + err);
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function CreateDimensionsToLine is unavailable');
        setInfo("info-markup", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function CreateDimensionsBetweenUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Creating dimensions between objects');
      setInfo("info-markup", "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏...");

      if (typeof A.CreateDimensionsBetweenObjects === 'function') {
        try {
          const success = await A.CreateDimensionsBetweenObjects();
          if (success) {
            AddLog('[UI] ‚úÖ Dimensions between objects created successfully');
            setInfo("info-markup", "‚úÖ –†–∞–∑–º–µ—Ä—ã –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Error creating dimensions between objects');
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling CreateDimensionsBetweenObjects: ' + err);
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function CreateDimensionsBetweenObjects is unavailable');
        setInfo("info-markup", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function CreateDimensionsToPointUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Creating dimensions to point');
      setInfo("info-markup", "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫ —Ç–æ—á–∫–µ...");

      if (typeof A.CreateDimensionsToPoint === 'function') {
        try {
          const success = await A.CreateDimensionsToPoint();
          if (success) {
            AddLog('[UI] ‚úÖ Dimensions to point created successfully');
            setInfo("info-markup", "‚úÖ –†–∞–∑–º–µ—Ä—ã –∫ —Ç–æ—á–∫–µ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Error creating dimensions to point');
            setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫ —Ç–æ—á–∫–µ");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling CreateDimensionsToPoint: ' + err);
          setInfo("info-markup", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function CreateDimensionsToPoint is unavailable');
        setInfo("info-markup", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    // ================= GROUNDING / OFFSET =================
    async function SetGroundSurfaceUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Selecting 3D mesh for landing');
      setInfo("info-ground", "–í—ã–±–æ—Ä 3D —Å–µ—Ç–∫–∏...");

      if (typeof A.SetGroundSurface === 'function') {
        try {
          const success = await A.SetGroundSurface();
          if (success) {
            AddLog('[UI] ‚úÖ 3D mesh selected successfully');
            setInfo("info-ground", "‚úÖ 3D —Å–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ '–ü—Ä–∏–≤—è–∑–∞—Ç—å'");
          } else {
            AddLog('[UI] ‚ùå Error selecting 3D mesh');
            setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ 3D —Å–µ—Ç–∫–∏");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling SetGroundSurface: ' + err);
          setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function SetGroundSurface is unavailable');
        setInfo("info-ground", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function SetGroundObjectsUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Selecting objects for landing');
      setInfo("info-ground", "–í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤...");

      if (typeof A.SetGroundObjects === 'function') {
        try {
          const success = await A.SetGroundObjects();
          if (success) {
            AddLog('[UI] ‚úÖ Objects selected successfully');
            setInfo("info-ground", "‚úÖ –û–±—ä–µ–∫—Ç—ã –≤—ã–±—Ä–∞–Ω—ã. –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏—Ç–µ '–ü—Ä–∏–≤—è–∑–∞—Ç—å'");
          } else {
            AddLog('[UI] ‚ùå Error selecting objects');
            setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling SetGroundObjects: ' + err);
          setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function SetGroundObjects is unavailable');
        setInfo("info-ground", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function ApplyZDeltaUI() {
      AddLog('[UI] ===== ApplyZDeltaUI START =====');
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      const offsetStr = document.getElementById('groundOffset').value;
      AddLog('[UI] DEBUG: groundOffset.value = "' + offsetStr + '"');
      const offsetMm  = parseFloat(offsetStr);
      AddLog('[UI] DEBUG: parseFloat result = ' + offsetMm);
      if (isNaN(offsetMm)) {
        AddLog('[UI] Invalid offset value');
        setInfo("info-ground", "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏—è");
        return;
      }

      const offsetM = offsetMm / 1000.0;
      AddLog('[UI] Applying Z offset: ' + offsetMm + ' mm (' + offsetM + ' m)');
      setInfo("info-ground", "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏—è...");

      if (typeof A.ApplyZDelta === 'function') {
        try {
          AddLog('[UI] DEBUG: Calling A.ApplyZDelta(' + offsetM + ')');
          const success = await A.ApplyZDelta(offsetM.toString()); // avoid INTEGER coercion
          AddLog('[UI] DEBUG: A.ApplyZDelta returned: ' + success);
          if (success) {
            AddLog('[UI] ‚úÖ Offset applied successfully');
            setInfo("info-ground", "‚úÖ –°–º–µ—â–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: " + offsetMm + " –º–º");
          } else {
            AddLog('[UI] ‚ùå Error applying offset');
            setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–º–µ—â–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–±–æ—Ä)");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling ApplyZDelta: ' + err);
          setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function ApplyZDelta is unavailable');
        setInfo("info-ground", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function LandToMeshUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Landing to 3D mesh');
      setInfo("info-ground", "–ü—Ä–∏–≤—è–∑–∫–∞ –∫ 3D —Å–µ—Ç–∫–µ...");

      try {
        AddLog('[UI] Setting 3D mesh from selection...');
        const surfaceSuccess = await A.SetGroundSurface();
        if (!surfaceSuccess) {
          AddLog('[UI] ‚ùå Failed to set 3D mesh');
          setInfo("info-ground", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 3D —Å–µ—Ç–∫—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ 3D —Å–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–∞");
          return;
        }

        AddLog('[UI] Setting objects from selection...');
        const objectsSuccess = await A.SetGroundObjects();
        if (!objectsSuccess) {
          AddLog('[UI] ‚ùå Failed to set objects');
          setInfo("info-ground", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –≤—ã–±—Ä–∞–Ω—ã");
          return;
        }

        AddLog('[UI] Performing landing...');
        const success = await A.ApplyGroundOffset(0.0);
        if (success) {
          AddLog('[UI] ‚úÖ Landing completed successfully');
          setInfo("info-ground", "‚úÖ –û–±—ä–µ–∫—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ 3D —Å–µ—Ç–∫–µ");
        } else {
          AddLog('[UI] ‚ùå Landing error');
          setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏");
        }
      } catch (err) {
        AddLog('[UI] ‚ùå Error: ' + err);
          setInfo("info-ground", "‚ùå –û—à–∏–±–∫–∞: " + err);
      }
    }

    // ================= MESH CREATION =================
    async function CreateMeshUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[UI] ACAPI unavailable'); return; }

      AddLog('[UI] Creating contours and morph');
      setInfo("info-shell", "–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ –∏ –º–æ—Ä—Ñ–∞...");

      const width = parseNumber(document.getElementById('shellWidth'), 1000);
      const step  = parseNumber(document.getElementById('shellStep'), 500);
      const thickness = parseNumber(document.getElementById('shellThickness'), 0);
      
      if (width <= 0) {
        setInfo('info-shell', '–®–∏—Ä–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0');
        return;
      }
      if (step <= 0) {
        setInfo('info-shell', '–®–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0');
        return;
      }
      if (thickness < 0) {
        setInfo('info-shell', '–¢–æ–ª—â–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å >= 0');
        return;
      }

      if (typeof A.CreateMorphFromContour === 'function') {
        try {
          const params = "width:" + width + ",step:" + step + ",thickness:" + thickness;
          const success = await A.CreateMorphFromContour(params);
          if (success) {
            AddLog('[UI] ‚úÖ Contours and Morph created successfully');
            setInfo("info-shell", "‚úÖ –ö–æ–Ω—Ç—É—Ä—ã –∏ –ú–æ—Ä—Ñ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[UI] ‚ùå Error creating contours and morph');
            setInfo("info-shell", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–æ–≤ –∏ –º–æ—Ä—Ñ–∞");
          }
        } catch (err) {
          AddLog('[UI] ‚ùå Error calling CreateMorphFromContour: ' + err);
          setInfo("info-shell", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[UI] ‚ùå Function CreateMorphFromContour is unavailable');
        setInfo("info-shell", "‚ùå Function unavailable (update the plugin)");
      }
    }

    // ================= MESH FROM LINE =================
    function SelectBaseLineMesh() {
      const A = window.ACAPI;
      if (!A) { AddLog('[Mesh] ACAPI unavailable'); return; }
      if (!A.SetBaseLineForShell) {
        AddLog('[Mesh] API function SetBaseLineForShell is unavailable');
        setInfo('info-mesh-line', '–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)');
        return;
      }

      AddLog('[Mesh] Selecting base line...');
      setInfo('info-mesh-line', '–í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—É—é –ª–∏–Ω–∏—é (—Å–ø–ª–∞–π–Ω/–ø–æ–ª–∏–ª–∏–Ω–∏—è/–¥—É–≥–∞/–ª–∏–Ω–∏—è)...');

      Promise.resolve(A.SetBaseLineForShell()).then(success => {
        if (success) {
          setInfo('info-mesh-line', '‚úÖ –ë–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è –≤—ã–±—Ä–∞–Ω–∞!');
          AddLog('[Mesh] Base line selected');
        } else {
          setInfo('info-mesh-line', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é');
          AddLog('[Mesh] Line selection error');
        }
      }).catch(e => {
        AddLog('[Mesh] Error: ' + e);
        setInfo('info-mesh-line', '‚ùå –û—à–∏–±–∫–∞: ' + e);
      });
    }

    async function SetMeshForMesh() {
      const A = window.ACAPI;
      if (!A) { AddLog('[Mesh] ACAPI unavailable'); return; }

      AddLog('[Mesh] Setting mesh for contours...');
      setInfo("info-mesh-line", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ç–∫–∏...");

      if (typeof A.SetMeshSurfaceForShell === 'function') {
        try {
          const success = await A.SetMeshSurfaceForShell();
          if (success) {
            AddLog('[Mesh] ‚úÖ Mesh set successfully');
            setInfo("info-mesh-line", "‚úÖ –°–µ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[Mesh] ‚ùå Failed to set mesh. Make sure a mesh is selected');
            setInfo("info-mesh-line", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–∞");
          }
        } catch (err) {
          AddLog('[Mesh] ‚ùå Error calling SetMeshSurfaceForShell: ' + err);
          setInfo("info-mesh-line", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[Mesh] ‚ùå Function SetMeshSurfaceForShell is unavailable');
        setInfo("info-mesh-line", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    async function CreateMeshFromLineUI() {
      const A = window.ACAPI;
      if (!A) { AddLog('[Mesh] ACAPI unavailable'); return; }

      AddLog('[Mesh] Creating mesh from line');
      setInfo("info-mesh-line", "–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ –∏–∑ –ª–∏–Ω–∏–∏...");

      const width = parseNumber(document.getElementById('meshWidth'), 1000);
      const step  = parseNumber(document.getElementById('meshStep'), 500);
      const offset = parseNumber(document.getElementById('meshOffset'), 0);
      
      if (width <= 0) {
        setInfo("info-mesh-line", '–®–∏—Ä–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0');
        return;
      }
      if (step <= 0) {
        setInfo("info-mesh-line", '–®–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0');
        return;
      }

      if (typeof A.CreateMeshFromContour === 'function') {
        try {
          const params = "width:" + width + ",step:" + step + ",offset:" + offset;
          const success = await A.CreateMeshFromContour(params);
          if (success) {
            AddLog('[Mesh] ‚úÖ Mesh created successfully');
            setInfo("info-mesh-line", "‚úÖ –°–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
          } else {
            AddLog('[Mesh] ‚ùå Error creating mesh');
            setInfo("info-mesh-line", "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏");
          }
        } catch (err) {
          AddLog('[Mesh] ‚ùå Error calling CreateMeshFromContour: ' + err);
          setInfo("info-mesh-line", "‚ùå –û—à–∏–±–∫–∞: " + err);
        }
      } else {
        AddLog('[Mesh] ‚ùå Function CreateMeshFromContour is unavailable');
        setInfo("info-mesh-line", "‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω)");
      }
    }

    function onShift(mm) {
      const m = parseFloat(mm) / 1000;
      AddLog(`[UI] Shift click, delta=${m} m`);
      if (window.ACAPI_Call) ACAPI_Call('ApplyZDelta', m);
    }
    function onLand() {
      AddLog(`[UI] Land click`);
      if (window.ACAPI_Call) ACAPI_Call('ApplyGroundOffset', 0.0);
    }

    // =============== tabs / init ===============
    function openTab(evt, tabId) {
      const contents = document.getElementsByClassName("tabcontent");
      const links = document.getElementsByClassName("tablink");
      for (let i = 0; i < contents.length; i++) contents[i].style.display = "none";
      for (let i = 0; i < links.length; i++) links[i].classList.remove("active");
      const tab = document.getElementById(tabId);
      if (tab) tab.style.display = "block";
      evt.currentTarget.classList.add("active");
      AddLog('[UI] Tab ‚Üí ' + tabId);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ–µ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ Layers
      if (tabId === 'tab-layers') {
        whenACAPIReadyDo(function() {
          loadExistingLayersList();
        });
      }
    }
    window.openTab = openTab;

    window.addEventListener('DOMContentLoaded', function () {
      AddLog("[UI] Ready (UI v0.4)");

      // Enter handlers
      document.getElementById('distStep')    ?.addEventListener('keydown', e => { if (e.key === 'Enter') SetDistributionStep(); });
      document.getElementById('distCount')   ?.addEventListener('keydown', e => { if (e.key === 'Enter') SetDistributionCount(); });
      document.getElementById('groundOffset')?.addEventListener('keydown', e => { if (e.key === 'Enter') whenACAPIReadyDo(ApplyZDeltaUI); });
      document.getElementById('shellWidth')  ?.addEventListener('keydown', e => { if (e.key === 'Enter') CreateShellFromLine(); });
      document.getElementById('shellStep')   ?.addEventListener('keydown', e => { if (e.key === 'Enter') CreateShellFromLine(); });

      // ID + Layers tab
      document.getElementById('baseID')      ?.addEventListener('keydown', e => { if (e.key === 'Enter') changeAllSelectedIDs(); });
      document.getElementById('layerFolder') ?.addEventListener('keydown', e => { if (e.key === 'Enter') createLayerAndMoveElements(); });
      document.getElementById('layerName')   ?.addEventListener('keydown', e => { if (e.key === 'Enter') createLayerAndMoveElements(); });
      
      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–æ–µ–≤ –ø—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª–µ Layer Folder
      document.getElementById('layerFolder')?.addEventListener('input', function(e) {
        const filterText = e.target.value.trim();
        if (allLayersData.length > 0) {
          filterLayersList(filterText);
        }
      });
      
      // Markup
      document.getElementById('markupStep')  ?.addEventListener('keydown', e => { if (e.key === 'Enter') whenACAPIReadyDo(SetMarkupStepUI); });

      // help buttons
      document.addEventListener('click', function (e) {
        const el = e.target.closest('[data-help-url]');
        if (!el) return;
        e.preventDefault();
        let url = el.getAttribute('data-help-url') || 'https://landscape.227.info/help/start';
        const separator = url.includes('?') ? '&' : '?';
        const timestamp = Date.now();
        url = url + separator + 'v=' + timestamp;
        AddLog('[UI] help ‚Üí ' + url);

        const A = window.ACAPI;
        if (A && typeof A.OpenHelp === 'function') {
          Promise
            .resolve(A.OpenHelp(url))
            .then(() => AddLog('[UI] ACAPI.OpenHelp ok'))
            .catch(err => AddLog('[UI] ACAPI.OpenHelp error: ' + err));
        } else {
          AddLog('[UI] ACAPI.OpenHelp not found ‚Üí window.open');
          window.open(url, '_blank', 'noopener,noreferrer');
        }
      });

      // wait for bridge, then fill selection table
      whenACAPIReadyDo(() => {
        UpdateSelectedElements();
      });

      // default tab: Distribution
      const distribTab = document.querySelector('button[onclick*="tab-distrib"]');
      if (distribTab) distribTab.click();
    });
  </script>
</head>

<body>
  <!-- LANDSCAPE HELPER Logo -->
  <div class="logo-container">
    <div class="logo-icon">
      <div class="mountain"></div>
    </div>
    <div class="logo-text">
      <div class="logo-title">LANDSCAPE HELPER</div>
      <div class="logo-subtitle">–ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø –õ–ê–ù–î–®–ê–§–¢–ù–û–ì–û –ü–†–û–ï–ö–¢–ò–†–û–í–ê–ù–ò–Ø</div>
    </div>
  </div>

  <!-- Selection Table -->
  <table class="selection-table">
    <thead>
      <tr><th colspan="4">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</th></tr>
      <tr><th>–¢–∏–ø</th><th>ID</th><th>–°–ª–æ–π</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th></tr>
    </thead>
    <tbody id="selection"><tr><td colspan="4">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</td></tr></tbody>
  </table>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tablink" onclick="openTab(event,'tab-distrib')">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</button>
    <button class="tablink" onclick="openTab(event,'tab-orient')">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è</button>
    <button class="tablink" onclick="openTab(event,'tab-ground')">–ü—Ä–∏–≤—è–∑–∫–∞</button>
    <button class="tablink" onclick="openTab(event,'tab-markup')">–†–∞–∑–º–µ—Ç–∫–∞</button>
    <button class="tablink" onclick="openTab(event,'tab-shell')">–ö–æ–Ω—Ç—É—Ä—ã</button>
    <button class="tablink" onclick="openTab(event,'tab-mesh')">–°–µ—Ç–∫–∞</button>
    <button class="tablink" onclick="openTab(event,'tab-id')">ID</button>
    <button class="tablink" onclick="openTab(event,'tab-layers')">–°–ª–æ–∏</button>
    <button class="tablink" onclick="openTab(event,'tab-columns')">–£–≥–æ–ª</button>
  </div>

  <!-- Distribution -->
  <div id="tab-distrib" class="tabcontent">
    <fieldset class="control-block">
      <legend>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</legend>
      <div style="text-align:center;">
        <input type="button" onclick="SetDistributionLine()" value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–Ω–∏—é"><br><br>
        <input type="button" onclick="SetDistributionObject()" value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç">
      </div>
      <div>
        <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</label>
        <input type="number" id="distStep" step="1" value="0">
        <input type="button" onclick="SetDistributionStep()" value="–û–ö">
      </div>
      <div>
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" id="distCount" step="1" value="1">
        <input type="button" onclick="SetDistributionCount()" value="–û–ö">
      </div>
      <div id="info-dist" class="info-box">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/distribution?embed=1"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Orientation -->
  <div id="tab-orient" class="tabcontent">
    <fieldset class="control-block">
      <legend>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è</legend>
      <div>
        <label>–£–≥–æ–ª:</label>
        <input type="number" id="rotateAngle" step="1" value="0">
        <input type="button" onclick="RotateSelection()" value="–ü–æ–≤–µ—Ä–Ω—É—Ç—å">
      </div>
      <div style="text-align:center; margin-top:10px;">
        <input type="button" onclick="AlignSelectionX()" value="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ X"><br><br>
        <input type="button" onclick="RandomizeAngles()" value="–°–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª (0-360)"><br><br>
        <input type="button" onclick="OrientObjectsToPoint()" value="–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ —Ç–æ—á–∫–µ">
      </div>
      <div id="info-orient" class="info-box">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É–≥–æ–ª –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/orientation?embed=1"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Grounding -->
  <div id="tab-ground" class="tabcontent">
    <fieldset class="control-block">
      <legend>–ü—Ä–∏–≤—è–∑–∫–∞</legend>

      <div style="text-align:center; margin-bottom:10px;">
        <label>–°–º–µ—â–µ–Ω–∏–µ Z (–º–º):</label>
        <input type="number" id="groundOffset" step="1" value="0">
        <input id="btnApplyOffset" type="button" onclick="whenACAPIReadyDo(ApplyZDeltaUI)" value="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">
      </div>

      <div style="text-align:center;">
        <input id="btnLand" type="button" onclick="whenACAPIReadyDo(LandToMeshUI)" value="–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Å–µ—Ç–∫–µ">
      </div>

      <div id="info-ground" class="info-box">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong><br>
        1. –í—ã–±–µ—Ä–∏—Ç–µ 3D —Å–µ—Ç–∫—É –∏ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ<br>
        2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Å–µ—Ç–∫–µ" –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ 3D —Å–µ—Ç–∫–µ<br>
        <br>
        <strong>–°–º–µ—â–µ–Ω–∏–µ:</strong> "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" ‚Äî –ø—Ä–æ—Å—Ç–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –ø–æ Z (–±–µ–∑ 3D —Å–µ—Ç–∫–∏)
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/ground?embed=1"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –ü—Ä–∏–≤—è–∑–∫–∞">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Markup -->
  <div id="tab-markup" class="tabcontent">
    <fieldset class="control-block">
      <legend>–†–∞–∑–º–µ—Ä—ã –∏ —Ä–∞–∑–º–µ—Ç–∫–∞</legend>

      <div style="text-align:center; margin-bottom:15px;">
        <label>–®–∞–≥ —Ä–∞–∑–º–µ—Ç–∫–∏ (–º–º):</label>
        <input type="number" id="markupStep" step="1" value="2500" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ —à–∞–≥ –≤ –º–º">
        <input id="btnSetMarkupStep" type="button" onclick="whenACAPIReadyDo(SetMarkupStepUI)" value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">
      </div>

      <div style="text-align:center; margin-bottom:15px;">
        <input id="btnCreateMarkup" type="button" onclick="whenACAPIReadyDo(CreateMarkupUI)" value="–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É">
      </div>

      <div style="text-align:center; margin-bottom:15px;">
        <input id="btnCreateDimensionsToLine" type="button" onclick="whenACAPIReadyDo(CreateDimensionsToLineUI)" value="–†–∞–∑–º–µ—Ä—ã –∫ –ª–∏–Ω–∏–∏">
      </div>

      <div style="text-align:center; margin-bottom:15px;">
        <input id="btnCreateDimensionsBetween" type="button" onclick="whenACAPIReadyDo(CreateDimensionsBetweenUI)" value="–†–∞–∑–º–µ—Ä—ã –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏">
      </div>

      <div style="text-align:center; margin-bottom:15px;">
        <input id="btnCreateDimensionsToPoint" type="button" onclick="whenACAPIReadyDo(CreateDimensionsToPointUI)" value="–†–∞–∑–º–µ—Ä—ã –∫ —Ç–æ—á–∫–µ">
      </div>

      <div id="info-markup" class="info-box">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong><br>
        <strong>1. –°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É:</strong><br>
        ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —à–∞–≥ —Ä–∞–∑–º–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000 –º–º)<br>
        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞<br>
        ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏ (–ü–ª–∏—Ç–∞, –°–µ—Ç–∫–∞, –û–±–æ–ª–æ—á–∫–∞, –°—Ç–µ–Ω–∞) –∏–ª–∏ –ª–∏–Ω–∏–∏ (–õ–∏–Ω–∏—è, –ü–æ–ª–∏–ª–∏–Ω–∏—è, –î—É–≥–∞, –°–ø–ª–∞–π–Ω)<br>
        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É"<br><br>
        <strong>2. –†–∞–∑–º–µ—Ä—ã –∫ –ª–∏–Ω–∏–∏:</strong><br>
        ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã (–û–±—ä–µ–∫—Ç/–ö–æ–ª–æ–Ω–Ω–∞/–õ–∞–º–ø–∞)<br>
        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–º–µ—Ä—ã –∫ –ª–∏–Ω–∏–∏"<br>
        ‚Ä¢ –£–∫–∞–∂–∏—Ç–µ –¥–≤–µ —Ç–æ—á–∫–∏ –ª–∏–Ω–∏–∏<br><br>
        <strong>3. –†–∞–∑–º–µ—Ä—ã –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏:</strong><br>
        ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã (–û–±—ä–µ–∫—Ç/–ö–æ–ª–æ–Ω–Ω–∞/–õ–∞–º–ø–∞)<br>
        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–º–µ—Ä—ã –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏"<br><br>
        <strong>4. –†–∞–∑–º–µ—Ä—ã –∫ —Ç–æ—á–∫–µ:</strong><br>
        ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã (–û–±—ä–µ–∫—Ç/–ö–æ–ª–æ–Ω–Ω–∞/–õ–∞–º–ø–∞)<br>
        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–º–µ—Ä—ã –∫ —Ç–æ—á–∫–µ"<br>
        ‚Ä¢ –£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —Ç–æ—á–∫—É
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/dimensions"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –†–∞–∑–º–µ—Ç–∫–∞">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Contours -->
  <div id="tab-shell" class="tabcontent">
    <fieldset class="control-block">
      <legend>–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—É—Ä—ã –∏–∑ –ª–∏–Ω–∏–∏</legend>

      <div style="text-align:center; margin-bottom:10px;">
        <input type="button" 
               onclick="SelectBaseLine()" 
               value="–í—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é"
               style="font-size:14px; padding:6px 15px; font-weight:bold;">
      </div>

      <div>
        <label>–®–∏—Ä–∏–Ω–∞ (–º–º):</label>
        <input type="number" id="shellWidth" step="1" value="1000">
      </div>

      <div>
        <label>–®–∞–≥ (–º–º):</label>
        <input type="number" id="shellStep" step="1" value="500">
      </div>

      <div style="text-align:center; margin-top:15px;">
        <input type="button" 
               onclick="CreateShellFromLine()" 
               value="–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—É—Ä—ã"
               style="font-size:16px; padding:8px 20px; font-weight:bold;">
      </div>

      <div id="info-shell" class="info-box">
        –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç—É—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –∏–∑ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.<br>
        <strong>–î–ª—è —Å–ø–ª–∞–π–Ω–∞:</strong> —Ä–∞–∑–º–µ—â–∞–µ—Ç —Ç–æ—á–∫–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º —à–∞–≥–æ–º, —Å—Ç—Ä–æ–∏—Ç –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä—ã<br>
        <strong>–î–ª—è –¥—Ä—É–≥–∏—Ö –ª–∏–Ω–∏–π:</strong> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å, —Å—Ç—Ä–æ–∏—Ç –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä—ã –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ<br>
        –°–æ–∑–¥–∞–µ—Ç –¥–≤–∞ –±–æ–∫–æ–≤—ã—Ö –∫–æ–Ω—Ç—É—Ä–∞ (–ª–µ–≤—ã–π/–ø—Ä–∞–≤—ã–π –°–ø–ª–∞–π–Ω—ã) —Å –∑–∞–º—ã–∫–∞—é—â–∏–º–∏ –ª–∏–Ω–∏—è–º–∏ (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ª–∏–Ω–∏–π).<br>
        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—É—é –ª–∏–Ω–∏—é (—Å–ø–ª–∞–π–Ω/–ø–æ–ª–∏–ª–∏–Ω–∏—è/–¥—É–≥–∞/–ª–∏–Ω–∏—è).<br><br>
        <strong>–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é" –¥–ª—è –≤—ã–±–æ—Ä–∞ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏<br>
        2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –®–∏—Ä–∏–Ω–∞ –∏ –®–∞–≥<br>
        3. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—É—Ä—ã" ‚Äî —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—É—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ (–ª–µ–≤—ã–π/–ø—Ä–∞–≤—ã–π –°–ø–ª–∞–π–Ω—ã + –∑–∞–º—ã–∫–∞—é—â–∏–µ –ª–∏–Ω–∏–∏)
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/shell"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –ö–æ–Ω—Ç—É—Ä—ã">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Mesh -->
  <div id="tab-mesh" class="tabcontent">
    <fieldset class="control-block">
      <legend>–°–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É –∏–∑ –ª–∏–Ω–∏–∏</legend>

      <div style="text-align:center; margin-bottom:10px;">
        <input type="button" 
               onclick="SelectBaseLineMesh()" 
               value="–í—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é"
               style="font-size:14px; padding:6px 15px; font-weight:bold;">
      </div>

      <div style="text-align:center; margin-bottom:10px;">
        <input type="button" 
               onclick="SetMeshForMesh()" 
               value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É"
               style="font-size:14px; padding:6px 15px; font-weight:bold;">
      </div>

      <div>
        <label>–®–∏—Ä–∏–Ω–∞ (–º–º):</label>
        <input type="number" id="meshWidth" step="1" value="1000">
      </div>

      <div>
        <label>–®–∞–≥ (–º–º):</label>
        <input type="number" id="meshStep" step="1" value="500">
      </div>

      <div>
        <label>Offset (–º–º):</label>
        <input type="number" id="meshOffset" step="1" value="0">
      </div>

      <div style="text-align:center; margin-top:15px;">
        <input type="button" 
               onclick="whenACAPIReadyDo(CreateMeshFromLineUI)" 
               value="–°–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É –∏–∑ –ª–∏–Ω–∏–∏"
               style="font-size:16px; padding:8px 20px; font-weight:bold;">
      </div>

      <div id="info-mesh-line" class="info-box">
        –°–æ–∑–¥–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –°–µ—Ç–∫–∞ –∏–∑ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.<br>
        <strong>–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é" –¥–ª—è –≤—ã–±–æ—Ä–∞ –±–∞–∑–æ–≤–æ–π –ª–∏–Ω–∏–∏ (—Å–ø–ª–∞–π–Ω/–ø–æ–ª–∏–ª–∏–Ω–∏—è/–¥—É–≥–∞/–ª–∏–Ω–∏—è)<br>
        2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –®–∏—Ä–∏–Ω–∞ –∏ –®–∞–≥<br>
        3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É" –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∫–∏ –¥–ª—è Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç<br>
        4. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É –∏–∑ –ª–∏–Ω–∏–∏" ‚Äî —Å–æ–∑–¥–∞–µ—Ç—Å—è –°–µ—Ç–∫–∞ –∏–∑ –∑–∞–º–∫–Ω—É—Ç–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞<br><br>
        <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ï—Å–ª–∏ —Å–µ—Ç–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –°–µ—Ç–∫–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ Z=0.0 (–∏–ª–∏ Z=offset –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω). –ï—Å–ª–∏ —Å–µ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –°–µ—Ç–∫–∞ —Å–ª–µ–¥—É–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ —Ä–µ–ª—å–µ—Ñ–∞ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º offset –∫ Z –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º.
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/mesh"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –°–µ—Ç–∫–∞">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>


  <!-- ID -->
  <div id="tab-id" class="tabcontent">
    <fieldset class="control-block">
      <legend>–ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ ID –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</legend>

      <label for="baseID">–ë–∞–∑–æ–≤–æ–µ –∏–º—è:</label>
      <input type="text" id="baseID" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –°–æ—Å–Ω–∞ –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω–∞—è" style="width: 200px; padding: 3px; margin: 3px 0;" />
      <br>
      <input type="button" value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ID –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤" onclick="changeAllSelectedIDs()" style="margin-top: 10px;" />

      <div class="info-box" id="id-change-info">
        –í–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤–æ–µ –∏–º—è –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É. –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—Ç ID —Å –Ω–æ–º–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: –°–æ—Å–Ω–∞ –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω–∞—è-01, –°–æ—Å–Ω–∞ –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω–∞—è-02...)
      </div>

      <button class="tab-help"
              data-help-url="https://landscape.227.info/help/selection"
              data-help-title="–°–ø—Ä–∞–≤–∫–∞: –í—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤">–°–ø—Ä–∞–≤–∫–∞</button>
    </fieldset>
  </div>

  <!-- Layers -->
  <div id="tab-layers" class="tabcontent">
    <fieldset class="control-block">
      <legend>–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É/—Å–ª–æ–π –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</legend>

      <div style="display: flex; gap: 15px; align-items: flex-start; margin-bottom: 10px;">
        <div style="flex: 1;">
          <label style="display: block; margin-bottom: 5px;">–ü–∞–ø–∫–∞ —Å–ª–æ—è:</label>
          <input type="text" id="layerFolder" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –õ–∞–Ω–¥—à–∞—Ñ—Ç/–†–∞—Å—Ç–µ–Ω–∏—è" style="width: 100%; padding: 5px; margin-bottom: 5px;" />
          <small style="color:#666; font-size:11px;">–†–∞–∑–¥–µ–ª—è–π—Ç–µ –ø–æ–¥–ø–∞–ø–∫–∏ —Å–∏–º–≤–æ–ª–æ–º "/" (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–õ–∞–Ω–¥—à–∞—Ñ—Ç/–†–∞—Å—Ç–µ–Ω–∏—è/–î–µ—Ä–µ–≤—å—è")</small>
        </div>

        <div style="flex: 1;">
          <label style="display: block; margin-bottom: 5px;">–ù–æ–≤—ã–π —Å–ª–æ–π:</label>
          <input type="text" id="layerName" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –°–æ—Å–Ω—ã –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–µ" style="width: 100%; padding: 5px;" />
        </div>
      </div>

      <div style="margin-bottom: 15px;">
        <label style="font-weight: bold; display: block; margin-bottom: 5px;">–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞–ø–∫–∏ –∏ —Å–ª–æ–∏:</label>
        <select id="existingLayersList" 
                size="8" 
                style="width: 100%; padding: 5px; font-family: monospace; font-size: 12px; border: 1px solid #aaa; border-radius: 4px; background: #f9f9f9;"
                onchange="selectFromList()"
                ondblclick="selectFromList()">
          <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
        </select>
        <small style="color:#666; font-size:11px;">–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –¥–≤–∞–∂–¥—ã —â–µ–ª–∫–Ω–∏—Ç–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–ø–∫–∏/—Å–ª–æ—è</small>
      </div>

      <div style="text-align:left; margin-top:10px;">
        <input type="checkbox" id="hideLayer" style="margin-right:8px; cursor:pointer;" />
        <label for="hideLayer" style="cursor:pointer; font-size:13px;">–°–∫—Ä—ã—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–ª–æ–π</label>
      </div>

      <div style="text-align:center; margin-top:15px;">
        <input type="button" 
               onclick="createLayerAndMoveElements()" 
               value="–°–æ–∑–¥–∞—Ç—å –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å"
               style="font-size:16px; padding:8px 20px; font-weight:bold; background:#4F604F; color:white; border:none; border-radius:4px; cursor:pointer;">
      </div>

      <div id="info-layers" class="info-box">
        –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:<br>
        ‚Ä¢ –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ —Å–ª–æ—è (–µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)<br>
        ‚Ä¢ –í —ç—Ç–æ–π –ø–∞–ø–∫–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–ª–æ–π<br>
        ‚Ä¢ –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ —ç—Ç–æ—Ç —Å–ª–æ–π<br>
        ‚Ä¢ –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≥–∞–ª–æ—á–∫–∞ "–°–∫—Ä—ã—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–ª–æ–π", —Å–ª–æ–π –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç<br>
        ‚Ä¢ ID —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ (–º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ)<br>
        ‚Ä¢ –≠—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å —Å –ø–æ–º–æ—â—å—é Ctrl+Z
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/layers"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –°–ª–æ–∏ –∏ ID">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- Angle -->
  <div id="tab-columns" class="tabcontent">
    <fieldset class="control-block">
      <legend>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –±–∞–ª–æ–∫</legend>
      <div style="text-align:center; margin-bottom:15px;">
        <input type="button" 
               onclick="SetBeamsForOrient()" 
               value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∫–∏"
               style="font-size:14px; padding:8px 20px; font-weight:bold; margin-bottom:10px;">
        <br>
        <input type="button" 
               onclick="SetMeshForColumns()" 
               value="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É"
               style="font-size:14px; padding:8px 20px; font-weight:bold; margin-bottom:10px;">
        <br>
        <input type="button" 
               onclick="OrientBeamsToSurface()" 
               value="–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏"
               style="font-size:16px; padding:10px 25px; font-weight:bold; background:#4F604F; color:white; border:none; border-radius:4px; cursor:pointer; margin-top:10px;">
      </div>
      <div id="info-beams" class="info-box">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong><br>
        1. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∫–∏"<br>
        2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å —Å–µ—Ç–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É"<br>
        3. –ù–∞–∂–º–∏—Ç–µ "–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏" –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –±–∞–ª–æ–∫ –ø–æ —Å–µ—Ç–∫–µ<br>
        <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –î–ª–∏–Ω–∞ –±–∞–ª–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∫–∏ —Å–ª–µ–¥—É–µ—Ç –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
      </div>
    </fieldset>

    <fieldset class="control-block" style="margin-top:20px;">
      <legend>–ü–æ–≤–µ—Ä–Ω—É—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ</legend>
      <div style="text-align:center; margin-bottom:15px;">
        <input type="number" 
               id="rotateAngleInput"
               step="0.1"
               value="0"
               placeholder="–£–≥–æ–ª (–≥—Ä–∞–¥—É—Å—ã)"
               style="font-size:14px; padding:8px 15px; width:150px; margin-bottom:10px; text-align:center;">
        <br>
        <input type="button" 
               onclick="RotateSelectedOrientation()" 
               value="–ü–æ–≤–µ—Ä–Ω—É—Ç—å"
               style="font-size:16px; padding:10px 25px; font-weight:bold; background:#4F604F; color:white; border:none; border-radius:4px; cursor:pointer; margin-top:10px;">
      </div>
      <div id="info-rotate" class="info-box">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong><br>
        1. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–ª–∫–∏<br>
        2. –í–≤–µ–¥–∏—Ç–µ —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π)<br>
        3. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–≤–µ—Ä–Ω—É—Ç—å" –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –±–∞–ª–æ–∫<br>
        <strong>–ü—Ä–∏–º–µ—Ä—ã:</strong><br>
        ‚Ä¢ +180¬∞ - –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ<br>
        ‚Ä¢ +90¬∞ - –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ
      </div>
    </fieldset>

    <button class="tab-help"
            data-help-url="https://landscape.227.info/help/columns"
            data-help-title="–°–ø—Ä–∞–≤–∫–∞: –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–ª–æ–Ω–Ω/–±–∞–ª–æ–∫">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>


  <!-- Black log strip -->
  <div id="log-box">[–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∂—É—Ä–Ω–∞–ª –ø–ª–∞–≥–∏–Ω–∞]</div>

  <a href="#"
     data-help-url="https://landscape.227.info/?embed=1"
     data-help-title="LandscapeHelper ‚Äî —Å–∞–π—Ç">
    landscape.227.info
  </a>
</body>
</html>
